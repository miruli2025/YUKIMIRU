# 2026-02-15

## SkiDash Japan - UI 回滚 & QA & 版本管理

### UI 改动
- Miru 要求从 Apple 极简风回滚到 glassmorphism 暗色主题
- 评分徽章经多轮调整：圆形→药丸形(pill)，半透明青色底+青色描边+青色数字，`/100`在右侧同行
- 卡片背景：`bg-[#1a1a1e]` 深色实底，金/银/铜细边框（透明度低）
- 雪场名字加大到 `text-2xl`
- 关键文件：ScoreBadge.tsx, TopCards.tsx, ResortTable.tsx, DatePicker.tsx, globals.css, layout.tsx

### QA 测试
- 制定了42项测试计划（UI 21项 + 数据7项 + 可用性14项）
- 数据准确性：天气条件完全匹配SF，温度/风速因聚合方式不同有偏差（可接受）
- 移动端问题已修：表格横向滚动OK，日期选择器改为 flex-nowrap overflow-x-auto

### 版本管理
- 引入 git 版本管理，当前 tag: **v1.0.0**
- CHANGELOG.md 已创建
- .gitignore 在 workspace 根目录（node_modules, .next, *.db, output, *.log, *.jsonl）
- git user: Kumo <kumo@skidash.jp>

### 小红书图片
- 封面：标题在上、日期在下（Miru 要求互换）
- 字体：Noto Sans SC（思源黑体）用于标题/日期/分数，Google Fonts 加载
- 分数颜色统一改为青色 #22d3ee
- 推荐理由字号 20px→24px
- 排名页：列对齐用固定宽度（天气40px, 新雪90px, 温度80px, 风速60px, 票价70px）
- 表头和数据行宽度统一

### Miru 偏好记录
- 不喜欢 Apple 极简风，偏好 glassmorphism 暗色主题
- 评分徽章要半透明底+描边，不要实色
- 对 UI 细节很在意（对齐、字体、颜色一致性）
- 需要通俗解释技术概念（无开发背景）
- 版本号从 v1.0.0 开始（不要 v0.x）

## SkiDash Japan - 北海道雪场扩展

### 需求与实现
- 新增北海道地区20个雪场，和东京周边22个区分开
- 首页加 tab 切换（东京周辺 / 北海道）
- 类型新增字段：`area: 'tokyo' | 'hokkaido'`、`hasDirectBus: boolean`
- 北海道距离起点：新千岁机场（公里数），有直达大巴交通加分

### 北海道评分权重调整
- 交通分：15% → **5%**（省出10%给雪况）
- 新雪：25% → **30%**，积雪深度：10% → **15%**
- 其余不变
- 交通评分：按新千岁公里数分档，hasDirectBus=true 额外+15（上限100）

### 区域标签
- 雪场名旁边加 region pill badge（汤泽、白马、二世古等）
- 样式：半透明 bg-white/[0.07]，10px 字号

### 中文化
- nameJa 和 region 全部改成中文（有官方中文名用中文，没有的保留原名）
- region 全部中文化：汤泽、白马、志贺高原、群马、二世古、札幌等

### 数据存储改进
- fetch-data.ts 从 UPSERT 改为纯 INSERT，保留所有历史预报记录
- API 查询时按 fetched_at DESC 取最新记录去重
- 加索引 idx_forecast_resort_date(resort_id, date, fetched_at DESC)
- 一年数据量估算：~25-30MB（42雪场×6天×365天）

### Hydration 修复
- 日期选择器的服务端/客户端时区不匹配导致 hydration error
- 改为客户端 useEffect 设置初始日期，避免 SSR 不一致

### 票价调查
- 当前票价是静态写死的旧数据，普遍偏低
- 查到16个雪场的2025-2026真实价格，大部分涨价20-80%
- 轻井泽王子涨幅最大（5500→10000，+82%）
- 二世古采用动态定价（通常/高峰期不同价）
- 还有26个雪场没查到（官网JS渲染/URL变更）
- 服务器内存1.9GB，跑不动 Chromium

### 基础设施
- 服务器内存 1.9GB，Next.js dev 占 434MB，OpenClaw 占 ~620MB
- Cloudflare tunnel（cloudflared）用于临时公网访问
- ngrok 需要注册，serveo 不稳定，cloudflared 免注册最好用

### Telegram 群组配置
- ⛷️滑雪场情报群（-5030135500）设为 requireMention: false，不用@就能收到消息

### v1.1.0 发布（深夜）
- 北海道20雪场全部上线，区域Tab切换
- 雪道难度比例列（🟢🔴⚫），42场雪道图按钮
- 票价全部更新至2025-2026赛季
- 夜场信息逐一核实
- 推荐卡片加小红书风格推荐理由
- Snow-Forecast 42场×6天数据采集成功
- DB旧UNIQUE约束问题：需要DROP TABLE重建
- 切换生产模式（next build + next start），解决 OOM 问题
- 服务器2GB内存，dev模式频繁OOM，生产模式稳定
- git tag v1.1.0
- 小红书卡片v1版字太小/封面不吸引人，子代理在出新方案（3-4版）
- Miru先去睡了，醒来看方案选择

## 小红书卡片 v2（2/15-2/17 跨日继续）

### XHS 卡片生成器完成
- `scripts/gen-xhs-cards.js` — 第1页 TOP 3 详情卡（东京+北海道各一张）
- `scripts/gen-xhs-pages.js` — 第2-3页完整排名列表（东京p2/p3 + 北海道p2/p3，共4张）
- 使用 Puppeteer-core + Chromium HTML→PNG 渲染，解决 node-canvas 不支持彩色 emoji 的问题
- 分辨率 2x（1800×2400），glassmorphism 暗色主题
- 输出目录：`public/cards/`

### 卡片布局
- **第1页**：TOP 3 详情卡，含排名、名称、区域pill、分数/100、英文名、雪道难度点（🟢🔴⚫）、6行统计数据、推荐理由
- **第2-3页**：紧凑列表行，网格对齐列（天气emoji、新雪、积雪、温度、风速、车程、雪道数、难度比例、🌙夜场）
- 列表页新增英文名（灰色12px，日文名下方）

### 品牌更名
- 从 SkiDash Japan 更名为 **yukimiru.jp**（雪见情报/YukiMiru）
- 卡片 footer 已更新："数据来源: snow-forecast.com | yukimiru.jp"

### 评分差异
- 卡片脚本使用简化评分（硬编码数据），与网站评分模块有15-20分差异
- TODO：后续从 DB 拉数据 + 统一评分模块

### v1.1.1 发布
- git tag v1.1.1 on commit `d52357c`
- 主要内容：小红书卡片生成器
